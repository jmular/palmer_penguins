---
title: "Palmer_Penguin_WalkThrough"
author: "J. Mular"
date: "11/1/22"
output:
  pdf_document: default
  html_document: default
description: Walkthrough of general R principals and code as it pertains to ggplots
---
Revisions: 
  1/20/22 cleaned up wording and renamed to distribute as a guide, added how to pull csv file from computer
  4/18/22 Added section "Quick Note for Other Important R Tools (Functions, If/Then Statements, For Loop)"
  4/21/22 Cleaned up wording to upload to GitHub

#Setting Up Environment
First thing is you have to set up your R environment by loading the packages you need

For this tutorial we'll be using 'tidyverse' and palmer penguins' and other packages to be used in future walkthroughs

To do this use the code install.packages()
```{r installing packages}
install.packages("tidyverse") #for ggplots
install.packages("palmerpenguins")
install.packages("corrplot") # for correlation plot
install.packages("GGally") # for parallel coordinate plot
install.packages("e1071") # for svm

```
Note: Palmer Penguins is a package that is directly available from CRAN and you can install it the same way you would tidyverse packages

To import csv files into RStudio, use the read.csv and copy the pathway of where it is stored on your compute (note: move your file out of downloads for best practice)
```{r read.csv example}
hotel_booking <- read.csv("C:\\Users\\jmula\\OneDrive\\Desktop\\hotel_bookings.csv")
```

To use a package you must load them first which can be done with the library() function
```{r library, loading packages}
library(tidyverse)
library(palmerpenguins)
library(corrplot) 
library(GGally) 
library(e1071)
```

#Viewing the Data of Penguins to understand what we're working with
When first working with any sort of data you want to understand the specifics of it.
```{r viewing summary of penguins}
summary(penguins)
```
Note you can also use glimpse(penguins) as another way to look at the data

To see column names of a data set use colnames function
```{r viewing column names}
colnames(penguins)
```

The output shoes the column names as species, island, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g, sex, year


#Cleaning and Coloring
Looking through the data we can see some open spots for some of the data, to make sure what we're working with for our questions is full data let's filter out the null data.

```{r filtering in for sex}
penguins <- penguins %>% filter(sex == 'MALE' | sex == 'FEMALE')
summary(penguins)
```
Because there are two sexes within this data base we can filter an in clause.

If we wanted to get rid of na data in another way we can do
```{r removing null data (filtering out)}
penguins<- penguins %>% filter(!is.na(sex))
summar(penguins)
```


We can see there are three main species that make up the data, since we'll be using the different species for each question we're answering let's color code them to make it a bit easier to read.

```{r colorcoding species}
pCol <- c('blue', 'red','green')
names(pCol) <- c('Gentoo', 'Adelie', 'Chinstrap')
plot(penguins, col = pCol[penguins$species], pch = 19)
```

#Example Questions

##Question 1: Do the penguin species live together on the same island? If so what are the counts of each?

First let's get a count of the species on island. We can do this in two ways

```{r count of species by island}
island_counts_by_species <- penguins %>%
  group_by(island) %>%
  count(species)

View(island_counts_by_species)
```
That's one way, lets do something that's a bit more readable

```{r table of count of species}
table(penguins$species, penguins$island)
```
For our purposes the second way (table) would probably suit our needs better but other data types might be better for the first way.

From this data we can easily see there is a strong relationship between what species a penguin is and what island they are on.

Findings for this question:
Gentoo lives ONLY on Biscoe island
Chinstrap lives ONLY on Dream island
and the Adelie lives on every island counted (roughly the same percentage)

##Question 2: What are the different relational features involving sex? Are these relationships statistically significant?

###How is sex relational to species?
```{r species vs. sex table}
table(penguins$sex, penguins$species)
```
Now that we have our table how can we tell if something is significant?

We can use the chisq.test!

The chi-square test of independence evaluates whether there is an association between the categories of the two variables

It uses a null and alternative hypothesis

H0: (null hypothesis) two variables are independent (i.e. "There's no effect on the population")
H1: (alternative hypothesis) two variables are not independent (i.e. "There is an effect in the population")

To determine which hypothesis is supported we use p-value

A p-value is a statistical measurement used to validate a hypothesis against observed data.
  A p-value measures the probability of obtaining the observed results, assuming that the null hypothesis is true.
  The lower the p-value, the greater the statistical significance of the observed difference

A p-value of 0.05 or lower is generally considered statistically significant

```{r chisq.test for species v. sex}
chisq.test(table(penguins$sex, penguins$species)) 
```
Since the p-value (0.976) of the text is GREATER than 0.05, is not considered statistically significant and indicates strong evidence for the null hypothesis

Reminder: Null hypothesis means they are independent of eachother.

Conclusion: Results give evidence there is no effect of sex on the species.


###How is sex relational to the island the penguin lives on?
We can use the same set up of calculations as before

```{r island vs. sex table}
table(penguins$sex, penguins$island)
```

Is it statistically significant?
```{r chisq.test for island v. sex}
chisq.test(table(penguins$sex, penguins$island)) 
```

Reminder p-value is greater than 0.05 meaning not statistically significant

#Making Plots Using ggplot
Make sure you upload ggplot using the library function if you have not already!

Using our example of counting species that are on the island

Let's try and make it more visually noticable and use one of the plotting tools from the ggplot package.

##geom_jitter
For any ggplot we need to assign the x and y axis within the aes().

```{r ggplot of spcies by island}
ggplot(penguins) +
  geom_jitter(mapping = aes(x = island, y = species))
```
Now we can see a quick visual of how many of each species are in each island, (Note: I added a geom_jitter for visual clarity)

Geom_jitter functions as a scatterplot but differs from (geom_point [another scatterplot feature]) in that it only shows distinct points so that no points are overlapping.

##geom_point
geom_point leads to scatterplots but includes all the data

```{r geom_point}
ggplot(data=penguins)+
  geom_point(mapping=aes(x=flipper_length_mm, y=body_mass_g))
```

##geom_smooth
geom_smooth graphs leads to line plots; they are helpful for showing general trends in data

There is two types (called "methods") of smoothing
  *loess smoothing is best for <1000 points
          +#geom_smooth(method="loess")
  *gam smoothing (Generalized Additive Model smoothing): best for large # of points
          +#geom_smooth(method="gam")
  R will try and compute whichever method it deems appropriate but it's good to get in the habit of noting.

```{r geom_smooth example}
ggplot(data=penguins)+
  geom_smooth(method=loess, mapping=aes(x=flipper_length_mm, y=body_mass_g))
```

##combining geom_point and geom_smooth
GGplot visualizations can be piled on.

For example geom_point and geom_smooth can also be combined in a singular visualization
```{r combination geom_point and geom_smooth}
ggplot(data=penguins)+
  geom_point(mapping=aes(x=flipper_length_mm, y=body_mass_g))+
  geom_smooth(method=loess, mapping=aes(x=flipper_length_mm, y=body_mass_g))
```

##Cleaning Up Code
  If you notice your code getting a bit complicated (especially with two ggplots) you can change where you place you code of the aes (aestetics) to the section in the ggplot like below:
  
```{r cleaning up code}
ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g)) + 
  geom_point()+
  geom_smooth(method=loess)#note even if you move the aes you should still classify the method for geom_smooth
  
```

##Facet-ing Data
If you would like to see the information as small multiples of the visualization we can use the facet_wrap(~) 

```{r}
ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g, color=species)) + 
  geom_point()+
  geom_smooth(method=loess)+
  facet_wrap(~species)
```

#Labeling and Annotating Graphs and Other Aestetics
##Identifying Groups in Data
To identify a set of data from your code (for example type of species) we can add that information within our aes area. We can use color, size, and shape to distinguish

In the example below I used color:
```{r coloring the species in our ggplots}
ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g, color=species)) + 
  geom_point()+
  geom_smooth(method=loess)
```
  Aestetics can pile on each other, for example if you want the species to be seprate by color and shape add a comma and connect them

```{r coding the species ggplots with color and shape}
ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g, color=species, shape=species)) + 
  geom_point()+
  geom_smooth(method=loess)
```

The alpha function can be used as well, it shows the graph and legend with different transparencies. Note: this can be difficult for those with low-vision so use caution. 


###Labeling
To better let people know what your plots are about labels are helpful, you can add these by using the lab function.

```{r labelling}

ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g, color=species)) + 
  geom_point()+
  geom_smooth(method=loess)+
  labs(title="Palmer Penguins Body Breakdown", subtitle="Plot of length of flipper by body mass", caption="Data Collected by Dr. Kristen Gorman")
  
```

###Annotating
Annotations are a bit more difficult as you have to assign them to specific points, all of our aesthetics can be added to this as well

Other aesthetics can include bolding, size change, and text on an angle
```{r}
ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g,  color=species)) + 
  geom_point()+
  geom_smooth(method=loess)+
  labs(title="Palmer Penguins Body Breakdown", subtitle="Plot of length of flipper by body mass", caption="Data Collected by Dr. Kristen Gorman")+
  annotate("text", x=190,y=5000, label="The Gentoos are the largest", fontface="bold",size=4.5,angle=25)
```

#Quick Note for Other Important R Tools (Functions, If/Then Statements, For Loop)
Withing looking at ggplot codes you might come across other bits of R base:

Functions are when you have a specific item that you then put through the function to produce a value

If/Then Statements are for when a certain condition is met [if] something else happens [then]

For Loops are for when you want to have pieces of code that repeat or can build off of eachother
  Often these are used with a combination of other items
  
Lets see how these tools interact by counting the number of penguin data collected by species

```{r functions, for loop, and if/then combined}
count_species <- function(x, value) { #first turn into a variable for easy usage
                                #in the function the [value] becomes [count] when it is run
  count <- 0  #starting count at 0 value as best practice
  for (penguin in 1:length(x)) {  #begin a loop by specifying what you are looking for [penguin] within a vector [1:length(x)]
    if (x[penguin] == value)  #if (then) statements have condition [x[penguin] == value)] and then the action [count <- count + 1]
      {count <- count + 1} } #part of a loop is to allow for continuous function, this set up allows the count to be updated with each pass
  count} #this is the outcome of the function, ultimately what will be shown as the final when it's run
```

This loop within a function is then stored in a vector.
We can then use the vector to find the count for each individual species
```{r}
count_species(penguins$species, "Adelie") #the set up for this would be pulling the column name [penguins$species] and then specifying what you're looking for [Adelie]
count_species(penguins$species, "Gentoo")
count_species(penguins$species, "Chinstrap")

```

Note: There are easier ways to go about counting (as seen above) but this is a small way to see how these concepts can be used within greater bits of code

```
For more information and examples of using other ggplot functions (like geom_freqpoly and geom_boxplot): https://ggplot2-book.org/